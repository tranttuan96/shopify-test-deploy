import{c as b,a as j,h as g,n as h,b as w,d as $,l as m,o as S,p as W,i as A,e as D,s as P,f as O,g as E,r as T,v as F,w as H,C as U,t as _,y as q,z as N,A as V}from"./index.esm-66056b1d.js";import{_ as l,a as c,b as z,z as G}from"./theme-74fe61d9.js";/* empty css              */const R=e=>e.selectedAuditId,y=b(e=>e.auditList.data,e=>e.map(i=>Object.assign(Object.assign({},i),{occurredFormatted:i!=null&&i.occurred?new Date(Number(i==null?void 0:i.occurred)||0).toLocaleString():"N/A"})));b(R,y,(e,i)=>i.find(s=>e===s.id)),b(R,e=>!!e);const L=j("audit/search",(e,{extra:{api:i},getState:s})=>{const a=s().searchParams;return i.audit.search(Object.assign(Object.assign({},a),e))}),J=(e=>(...i)=>s=>{s.addCase(e.pending,(a,t)=>{i.forEach(({onPending:n})=>{n==null||n(a,t)})}),s.addCase(e.fulfilled,(a,t)=>{i.forEach(({onFulfilled:n})=>{n==null||n(a,t)})}),s.addCase(e.rejected,(a,t)=>{i.forEach(({onRejected:n})=>{n==null||n(a,t)})})})(L)({onPending:(e,i)=>{e.searchParams=Object.assign(Object.assign({},e.searchParams),i.meta.arg)},onFulfilled:(e,i)=>{e.auditList.data=i.payload}},(v=e=>e.auditList,{onFulfilled:e=>{v(e).loading=!1},onPending:e=>{v(e).loading=!0,v(e).error=null},onRejected:(e,i)=>{v(e).loading=!1,v(e).error=i.error}}));var v;const C={action:L,reducer:J},I={auditList:{data:[],loading:!1,error:null},searchParams:{text:"",sort:[]},selectedAuditId:""},B={search:"/v1/mgmt/audit/search"},K=({text:e,sort:i})=>l(void 0,void 0,void 0,function*(){return new Promise(s=>{const a=[];for(let t=1;t<9;t+=1)a.push({id:`Audit ${t}`,action:`Action ${t}`,actorId:`Actor ${t}`,type:"info",method:`Method ${t}`,userId:`User ${t}`,device:`Device ${t}`,geo:`Geo ${t}`,remoteAddress:`127.0.0.${t}`,externalIds:[`Login ID ${t}`],occurred:new Date().getTime()});i.forEach(t=>{a.sort((n,r)=>{var o,d;return t.desc?(d=r[t.field])===null||d===void 0?void 0:d.localeCompare(n[t.field]):(o=n[t.field])===null||o===void 0?void 0:o.localeCompare(r[t.field])})}),s(a.filter(t=>t.id.toLowerCase().includes(e.toLowerCase())||t.action.toLowerCase().includes(e.toLowerCase())||t.type.toLowerCase().includes(e.toLowerCase())||t.device.toLowerCase().includes(e.toLowerCase())||t.method.toLowerCase().includes(e.toLowerCase())||t.geo.toLowerCase().includes(e.toLowerCase())||t.remoteAddress.toLowerCase().includes(e.toLowerCase())||t.externalIds.includes(e.toLowerCase())||t.userId.toLowerCase().includes(e.toLowerCase())))})}),Q=({httpClient:e,tenant:i,mock:s})=>({search:({page:a,limit:t=1e4,text:n,sort:r,from:o}={})=>l(void 0,void 0,void 0,function*(){if(s)return K({page:a,limit:t,text:n,sort:r});const d=yield e.post(B.search,{limit:t,page:a,text:n,sort:r,from:o},{queryParams:{tenant:i}});return yield(u=>l(void 0,void 0,void 0,function*(){const p=yield u.text(),f=JSON.parse(p);if(!u.ok){const k=`${f.errorDescription}${f.errorMessage?`: ${f.errorMessage}`:""}`;throw Error(k||`${u.status} ${u.statusText}`)}u.json=()=>Promise.resolve(f),u.text=()=>Promise.resolve(p)}))(d),(yield d.json()).audits})}),X=g(e=>{var i,s,a,t;const n=h(W,S,m,$,w({tenant:w.missingAttrValidator}))(e);return t=class extends n{constructor(){super(...arguments),i.add(this),s.set(this,void 0)}get tenant(){return this.getAttribute("tenant")}get widgetId(){return this.getAttribute("widget-id")}get mock(){return this.getAttribute("mock")}get api(){return c(this,s,"f")||c(this,i,"m",a).call(this),c(this,s,"f")}init(){const r=Object.create(null,{init:{get:()=>super.init}});var o;return l(this,void 0,void 0,function*(){yield(o=r.init)===null||o===void 0?void 0:o.call(this),this.observeAttributes(["project-id","base-url","tenant"],()=>{c(this,s,"f")&&c(this,i,"m",a).call(this)})})}},s=new WeakMap,i=new WeakSet,a=function(){this.logger.debug("creating an sdk instance"),z(this,s,((r,o,d,u)=>{const p=G(Object.assign(Object.assign({},r),{persistTokens:!0,baseHeaders:{"x-descope-widget-type":"audit-management-widget","x-descope-widget-id":u,"x-descope-widget-version":"0.1.76"}}));return{audit:Q({httpClient:p.httpClient,tenant:o,mock:d})}})({projectId:this.projectId,baseUrl:this.baseUrl},this.tenant,this.mock==="true",this.widgetId),"f")},t}),x=g(e=>{const i=h(D({name:"widget",initialState:I,reducers:{setSelectedAuditId:(s,{payload:a})=>{s.selectedAuditId=a}},extraReducers:s=>{C.reducer(s)},asyncActions:{searchAudit:C.action}}),A,m,X)(e);return class extends i{constructor(...s){super(...s),this.state=I,this.subscribe(a=>{this.logger.debug("State update:",a),this.state=a})}}}),Y=g(e=>{const i=h(P,w({"widget-id":w.missingAttrValidator}))(e);return class extends i{get widgetId(){return this.getAttribute("widget-id")}fetchWidgetPage(s){return l(this,void 0,void 0,function*(){return(yield this.fetchStaticResource(`audit-management-widget/${this.widgetId}/${s}`,"text")).body})}}}),M=g(e=>{var i,s,a;return a=class extends h(m,A,E,O,Y,x)(e){constructor(){super(...arguments),i.add(this)}onWidgetRootReady(){return l(this,void 0,void 0,function*(){})}init(){const t=Object.create(null,{init:{get:()=>super.init}});var n;return l(this,void 0,void 0,function*(){yield(n=t.init)===null||n===void 0?void 0:n.call(this),yield Promise.all([c(this,i,"m",s).call(this)]),this.onWidgetRootReady()})}},i=new WeakSet,s=function(){return l(this,void 0,void 0,function*(){const t=T(yield this.fetchWidgetPage("root.html"));yield this.loadDescopeUiComponents(t),this.contentRootElement.append(t.content.cloneNode(!0))})},a}),Z=g(e=>{var i,s,a,t,n;return n=class extends h(m,M,x)(e){constructor(){super(...arguments),i.add(this),s.set(this,F(()=>{const r=this.rangeInput.value,o=new Date;let d;switch(r){case"minuets15":d=o.setMinutes(o.getMinutes()-15);break;case"hour":d=o.setHours(o.getHours()-1);break;case"hour6":d=o.setHours(o.getHours()-6);break;case"day":default:d=o.setDate(o.getDate()-1);break;case"day3":d=o.setDate(o.getDate()-3);break;case"week":d=o.setDate(o.getDate()-7);break;case"week2":d=o.setDate(o.getDate()-14);break;case"month":d=o.setMonth(o.getMonth()-1)}this.actions.searchAudit({text:this.searchInput.value,from:Math.floor(new Date(d).getTime())})}))}onWidgetRootReady(){const r=Object.create(null,{onWidgetRootReady:{get:()=>super.onWidgetRootReady}});var o;return l(this,void 0,void 0,function*(){yield(o=r.onWidgetRootReady)===null||o===void 0?void 0:o.call(this),c(this,i,"m",a).call(this),c(this,i,"m",t).call(this)})}},s=new WeakMap,i=new WeakSet,a=function(){var r;this.searchInput=new H((r=this.shadowRoot)===null||r===void 0?void 0:r.querySelector('[data-id="search-input"]'),{logger:this.logger}),this.searchInput.onInput(c(this,s,"f"))},t=function(){var r;this.rangeInput=new U((r=this.shadowRoot)===null||r===void 0?void 0:r.querySelector('[data-id="range-input"]'),{logger:this.logger}),this.rangeInput.onInput(c(this,s,"f"))},n}),ee=g(e=>{var i,s,a,t;return t=class extends h(x,m,M)(e){constructor(){super(...arguments),i.add(this),a.set(this,_(n=>{this.auditTable.data=n}))}onWidgetRootReady(){const n=Object.create(null,{onWidgetRootReady:{get:()=>super.onWidgetRootReady}});var r;return l(this,void 0,void 0,function*(){yield(r=n.onWidgetRootReady)===null||r===void 0?void 0:r.call(this),c(this,i,"m",s).call(this),c(this,a,"f").call(this,y(this.state)),this.subscribe(c(this,a,"f").bind(this),y)})}},a=new WeakMap,i=new WeakSet,s=function(){var n;this.auditTable=new q((n=this.shadowRoot)===null||n===void 0?void 0:n.querySelector('[data-id="audit-table"]'),{logger:this.logger}),this.auditTable.onSelectedItemsChange(r=>{this.actions.setSelectedAuditId(r.detail.value.map(({id:o})=>o))})},t}),te=g(e=>class extends h(V,N,ee,Z)(e){init(){const i=Object.create(null,{init:{get:()=>super.init}});var s;return l(this,void 0,void 0,function*(){yield(s=i.init)===null||s===void 0?void 0:s.call(this)})}}),ie=h(e=>class extends te(e){})(HTMLElement);customElements.define("descope-audit-management-widget",ie);export{ie as default};
